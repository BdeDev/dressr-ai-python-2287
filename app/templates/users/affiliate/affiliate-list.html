{% include "admin-includes/header.html" %}
{% load static %}
{% load extras %}
<div class="page-wrapper">
    <div class="content">
        <div class="page-header">
            <div class="page-title">
                <h4>Affiliate</h4>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
						<li class="breadcrumb-item"><a class="white-text" href="/">Dashboard</a></li>
                        <li class="breadcrumb-item"><a class="white-text" href="{% url 'users:affiliate_list' %}">Affiliate</a></li>
                    </ol>
                </nav>
            </div>
			<div class="page-btn d-flex flex-wrap">
				{% if users %}
				<form action="{% url 'users:download_customer_reports' %}?role_id=2" method="POST">
					{% csrf_token %} 			
					<input type="hidden" class="timezone" name="timezone">
					<div><button type="submit" class="btn btn-primary sharp me-2"><i class="fas fa-download me-2"></i>Export Csv</button></div>
				</form> 
				{% endif %}
            	{% comment %} <a class="btn btn-primary" href="{% url 'users:add_user' %}"><i class="fas fa-plus me-2"></i> Customer</a> {% endcomment %}
            </div>
        </div>
        <div class="card mt-2" >
            <div class="card-body" id="card_body_div">
				<div class='d-flex flex-wrap justify-content-between'>
					<!-- showing_objects-->
					{% include "admin-includes/showing_objects.html" with listing_objects=users %}
					<!-- showing_objects end-->
				</div>
                <div class="dataview">
                    <form onsubmit="Loader()" action="{% url 'users:users_list' %}" method="GET">
						<div class="table-responsive">
							<table class="table datatable">
								<thead>
									<tr>
										<th>Full Name</th>
										<th>Email</th>
										<th>Mobile Number</th>
										<th>Created on</th>
										<th>Status </th>
										<th>Actions</th>
									</tr>
								</thead>
								<thead>
									<tr class="search-row">
										<td><input type="text" value="{{request.GET.full_name}}" class="form-control" name="full_name" maxlength="20"></td>
										<td><input type="text" value="{{request.GET.email}}" class="form-control" name="email" maxlength="40"></td>
										<td><input type="text" value="{{request.GET.mobile_no}}" onkeypress="return /[0-9+\Enter]/i.test(event.key)" class="form-control" name="mobile_no" maxlength="20"></td>
										<td><input type="date" onkeydown="return false" value="{{request.GET.created_on}}" class="position-relative form-control" name="created_on" onchange="this.form.submit()"></td>
										<td>
											<select class="form-control" name="status" onchange="this.form.submit()">
												<option  value=""></option>
												<option {% if request.GET.status == '1' %} selected {% endif %} value="1">ACTIVE</option>
												<option {% if request.GET.status == '2' %} selected {% endif %} value="2">INACTIVE</option>
												<option {% if request.GET.status == '3' %} selected {% endif %} value="3">DELETED</option>
											</select>
										</td>
										<td><button type="submit" class="btn btn-primary">Search</button></td>
									</tr>
								</thead>
								<tbody>
									{% if users %}
										{% for user in users %}
										<tr {% if user.is_defaulter %}class="overdue-loan-color"{% endif %} >
											<td>
												<div class="d-flex align-items-center display-images">
													{% if user.profile_pic %}
													<a href="{{user.profile_pic.url}}" data-fancybox>
														<img src="{{user.profile_pic.url}}" class="rounded-lg me-2" width="24" alt="">
													</a>
													{% else %}
													<a href="{% static 'admin-assets/images/dp.png' %}" data-fancybox>
														<img src="{% static 'admin-assets/images/dp.png' %}"
														class="rounded-lg me-2" width="24" alt="">
													</a>
													{% endif %}
													{% if user.full_name %}
													<span class="w-space-no">{{ user.full_name }}</span>
													{% else %}
													<span class="w-space-no">-</span>
													{% endif %}
												</div>
											</td>
											<td class='clickable-row' data-href="{% url 'users:view_user' user.id %}">
												{% if user.email %}{{ user.email }}{% else %}-{% endif %}
											</td>
											<td class='clickable-row' data-href="{% url 'users:view_user' user.id %}">
												{% if user.mobile_no %}{% if user.country_code %}{{user.country_code}}{% endif %}{{ user.mobile_no }}{% else %}-{% endif %}
											</td>
											<td class='clickable-row' data-href="{% url 'users:view_user' user.id %}">
												<span class="w-space-no">
												<script>
													var date = ConvertDateTime("{{ user.created_on|date:'Y-m-d' }}", "{{ user.created_on|time:'H:i' }}");
													document.write(date);
												</script>
												</span>
											</td>
											
											<td class='clickable-row' data-href="{% url 'users:view_user' user.id %}">
												{% if user.status == 1 %}
												<span class="badge bg-success">ACTIVE</span>
												{% elif user.status == 2 %}
												<span class="badge bg-warning">INACTIVE</span>
												{% elif user.status == 3 %}
												<span class="badge bg-danger">DELETED</span>
												{% else %}
												-
												{% endif %}
											</td>
											<td>
												<div class="d-flex">
													<a title="View Details" href="{% url 'users:view_user' user.id %}" class="btn btn-success shadow btn-xs sharp me-1"><i class="fa fa-eye"></i></a>
												</div>
											</td>
										</tr>
										{% endfor %}
									{% endif %}
								</tbody>
							</table>
						</div>
					</form>
                    <!-- pagination-->
					{% include "admin-includes/pagination.html" with listing_objects=users %}
					<!-- pagination end-->
                </div>
            </div>
        </div>
    </div>
</div>
{% include "admin-includes/footer.html" %}
<script src="{% static 'admin-assets/js/customized-js/graph.js' %}"></script>
<script>
	// redirects on same div location after refresh
	$(document).ready(function() {
		if("{{scroll_required}}" == "True"){
			$('html, body').animate({
				scrollTop: ($("#card_body_div").offset().top + 170)
			}, 100);
		}
	});

	GetGraphData()
</script>