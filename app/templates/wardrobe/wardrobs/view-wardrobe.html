{% include "admin-includes/header.html" %}{% load static %}{% load extras %}
<div class="page-wrapper">
    <div class="content">
        <div class="page-header">
            <div class="page-title">
                <h4>Wardrobe </h4>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a class="white-text" href="{% url 'frontend:index' %}">Dashboard</a></li>
                        <li class="breadcrumb-item"><a class="white-text" href="{% url 'wardrobe:wardrobe_list' %}">Wardrobs</a></li>
                        <li class="breadcrumb-item active">Wardrobe Information</li>
                    </ol>
                </nav>
            </div>
            <div class="page-btn d-flex flex-wrap">
                <a class="btn btn-primary me-2" href="{% url 'wardrobe:view_item_wear_calender' wardrobe.id %}" ><i class="fas fa-calendar-alt me-1"></i> Calender</a>
                <a class="btn btn-secondary" href="{% url 'wardrobe:wardrobe_list' %}"><i class="fa fa-angle-left me-1"></i> Back</a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 col-lg-12 col-sm-12">
                <div class="card my-4">
                    <div class="card-body">
                        <p>** {{recommendations|safe}} </p>
                        <div class="row">
                        <div class=" col-md-6  productdetails">
                            <ul class="product-bar mb-2">
                                <li>
                                    <h4>Id </h4>
                                    <h6>{{wardrobe.id}}</h6>
                                </li>
                                <li>
                                    <h4> Name </h4>
                                    <h6>{{wardrobe.name|default:"-"}}</h6>
                                </li>
                                <li>
                                    <h4>User</h4>
                                    <h6>
                                        <div class="d-flex align-items-center display-images">
                                            {% if wardrobe.user.profile_pic %}
                                                <a href="{{wardrobe.user.profile_pic.url}}" data-fancybox>
                                                    <img src="{{wardrobe.user.profile_pic.url}}" class="rounded-lg me-2" width="50" alt="">
                                                </a>
                                            {% else %}
                                                <a href="{% static 'admin-assets/images/dp.png' %}" data-fancybox>
                                                    <img src="{% static 'admin-assets/images/dp.png' %}"
                                                    class="rounded-lg me-2" width="50" alt="">
                                                </a>
                                            {% endif %}
                                            <span><a href="{% url 'users:view_user' wardrobe.user.id %}" class="w-100">{{wardrobe.user.full_name|capfirst}}</a></span>
                                        </div>
                                    </h6>
                                </li>
                                <li>
                                    <h4>Created On </h4>
                                    <h6>
                                        <script>
                                            var date = ConvertDateTime("{{ wardrobe.created_on|date:'Y-m-d' }}", "{{ wardrobe.created_on|time:'H:i' }}");
                                            document.write(date);
                                        </script>
                                    </h6>
                                </li>
                            </ul>
                        </div>
                        <div class=" col-md-6  productdetails">
                            <ul class="product-bar mb-2">
                                <li>
                                    <h4>Total Items</h4>
                                    <h6>
                                        {{total_items}}
                                    </h6>
                                </li>
                                <li>
                                    <h4>Favourite Items Count</h4>
                                    <h6>
                                        <div class="d-flex justify-content-between">
                                            {% if favourite_items %}
                                            <span>
                                                <i class="fa fa-heart text-danger"></i>  {{favourite_items}}
                                            </span>
                                            {% else %}
                                            <span>
                                                <i class="fa fa-heart not-favourite"></i>  {{favourite_items}}
                                            </span>
                                            {% endif %}
                                            {% if favourite_items > 0 %}
                                            <a href="{% url 'ecommerce:wardrobe_favourite_items'  wardrobe.id %}">
                                                <span class="badge bg-success-custom"><i class="fa fa-eye me-1"></i>View</span>
                                            </a>
                                            {% endif %}
                                        </div>
                                    </h6>
                                </li>
                                <li>
                                    <h4> Most Wear </h4>
                                    <h6>
                                        {% if most_worn.wear_count > 0 %}
                                        <div class="d-flex align-items-center display-images">
                                            {% if most_worn.image %}
                                                <a href="{{most_worn.image.url}}" data-fancybox>
                                                    <img src="{{most_worn.image.url}}" class="rounded-lg me-2" width="50" alt="">
                                                </a>
                                            {% else %}
                                                <a href="{% static 'admin-assets/images/dp.png' %}" data-fancybox>
                                                    <img src="{% static 'admin-assets/images/dp.png' %}"
                                                    class="rounded-lg me-2" width="50" alt="">
                                                </a>
                                            {% endif %}
                                            <span>{{most_worn.title|capfirst}} {% if most_worn %}( {{most_worn.wear_count}} wears) {% endif %}</a></span>
                                        </div>
                                        {% else %}-{% endif %}
                                    </h6>
                                </li>
                                <li>
                                    <h4> Least Wear </h4>
                                    <h6>
                                        {% if least_worn %}
                                        <div class="d-flex align-items-center display-images">
                                            {% if least_worn.image %}
                                                <a href="{{least_worn.image.url}}" data-fancybox>
                                                    <img src="{{least_worn.image.url}}" class="rounded-lg me-2" width="50" alt="">
                                                </a>
                                            {% else %}
                                                <a href="{% static 'admin-assets/images/dp.png' %}" data-fancybox>
                                                    <img src="{% static 'admin-assets/images/dp.png' %}"
                                                    class="rounded-lg me-2" width="50" alt="">
                                                </a>
                                            
                                            {% endif %}
                                            <span>{{least_worn.title|capfirst}} {% if least_worn %}  ( {{least_worn.wear_count|capfirst}} wears){% endif %} </a></span>
                                        </div>
                                        {% else %}- {% endif %}
                                    </h6>
                                </li>
                                <li>
                                    <h4>Utilization</h4>
                                    <h6>
                                        {{ utilization|floatformat:2 }} %
                                    </h6>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row gap-3">
                <div class="card-body" id="card_body_div">
                    <div class="swiper mySwiper">
                        {% if wardrobe.items.count > 4  %}
                        <div class="text-end mb-2"><a href="{% url 'wardrobe:wardrobe_item_list' wardrobe.id %}" class="btn btn-primary-custom">View All<a></div>
                        {% endif %}
                        <div class="swiper-wrapper">
                            {% for item in cloth_items %}
                                {% is_favourite item.wardrobe.user item as item_is_favourite %}
                                <div class="swiper-slide">
                                    <div class="card" style="width: 18rem; position: relative;">
                                        {% if item.image %}
                                        <a href="{{ item.image.url }}" data-fancybox>
                                            <img src="{{ item.image.url }}" style="height:350px !important;" class="card-img-top" alt="">
                                        </a>
                                        <span class="heart-icon" onclick="toggleFavorite('{{ item.id }}')">
                                            {% if item_is_favourite %}
                                                <i class="fa fa-heart text-danger"></i>
                                            {% else %}
                                                <i class="fa fa-heart not-favourite"></i>
                                            {% endif %}
                                        </span>
                                        <a href="javascript:void(0);" onclick="getWardrobeItemDetails('{{ item.id }}')">
                                        {% endif %}
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <div class="hover-box">
                                                    {% comment %} <span class="text">{{ item.title|capfirst|default:"-" }}</span> {% endcomment %}
                                                    <button class="btn hover-btn" style="padding:0 !important; font-size:.8rem !important">
                                                        <span class="badge bg-success-custom">
                                                            <i class="fa fa-eye me-1"></i> View
                                                        </span>
                                                    </button>
                                                </div>
                                                <small>( Wears Times: {{item.wear_count}} )</small>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                            <p class="card-text">{{item.cloth_category.title|capfirst|default:"-"}}</p>
                                                <small>
                                                    <a href="{% url 'ecommerce:feedback_list' item.id %}">
                                                        <span class="badge bg-success-custom">{% if item.rating_set.count > 0  %} <i class="fa fa-eye me-1"></i>View Feedback: {% else %} Feedback: {% endif %}{{item.rating_set.count}}</span>
                                                    </a>
                                                </small>
                                            </div>
                                        </div>
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="view-details" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <div class="basic-form">
                    <div class="row">
                        <div class="col-md-12 col-lg-12 col-sm-12">
                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="card my-4">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6  productdetails">
                                            <h5><b>Item Detail</b></h5>
                                            <ul class="product-bar mb-2">
                                                <li>
                                                    <h4>Id </h4>
                                                    <h6><span id="item_id"></span></h6>
                                                </li>
                                                {% comment %} <li>
                                                    <h4> Title </h4>
                                                    <h6><span id="item_title"></span></h6>
                                                </li> {% endcomment %}
                                                <li>
                                                    <h4> Category </h4>
                                                    <h6><span id="item_category"></span></h6>
                                                </li>
                                                <li>
                                                    <h4> Wear Count </h4>
                                                    <h6><span id="item_wear_count"></span></h6>
                                                </li>
                                                <li>
                                                    <h4> Weather Type </h4>
                                                    <h6><span id="weather_type"></span>
                                                    </h6>
                                                </li> 
                                                <li>
                                                    <h4> Colour </h4>
                                                    <h6><span id="item_color"></span></h6>
                                                </li>
                                                <li>
                                                    <h4> Brand </h4>
                                                    <h6><span id="item_brand"></span></h6>
                                                </li>
                                                <li>
                                                    <h4> Occasion </h4>
                                                    <h6><span id="item_occasion"></span></h6>
                                                </li>
                                                <li>
                                                    <h4>Created On </h4>
                                                    <h6>
                                                        <span id="item_addedd_on"> </span>
                                                    </h6>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6 productdetails">
                                            <h5><b>Item Image</b></h5>
                                            <ul class="product-bar custom-size-img mb-2">
                                                <li>
                                                    <a id="item_image_link" data-fancybox>
                                                        <img id="item_image_img"  alt="">
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% include "admin-includes/footer.html" %}

<script>
    function getWardrobeItemDetails(itemId) {
        $.ajax({
            url: "{% url 'wardrobe:wardrobe_item_details' %}",
            type: "GET",
            data: { item_id: itemId },
            success: function(response) {
                let item = response.items_data;
                $("#item_id").text(item.id);
                if (item.cloth_category) {
                    $("#item_category").text(item.cloth_category);
                }else{
                     $("#item_category").text("-");
                }
                if (item.wear_count) {
                    $("#item_wear_count").text(item.wear_count);
                }else{
                     $("#item_wear_count").text("0");
                }
                if (item.color) {
                    $("#item_color").text(item.color);
                }else{
                     $("#item_color").text("-");
                }
                // $("#item_title").text(item.title);
                
                if (item.brand) {
                    $("#item_brand").text(item.brand);
                }else{
                     $("#item_brand").text("-");
                }
                $("#item_occasion").text(item.occasion);
                $("#item_addedd_on").text(item.created_on);
                $("#item_image_img").attr("src", item.image_url);
                $("#item_image_link").attr("href", item.image_url);
                const weatherTypeMapping = {
                    1: "Summer",
                    2: "Winter",
                    3: "Rainy Season",
                    4: "Spring Season",
                    5: "All Seasons"
                };
                let weatherVal = parseInt(item.weather_type);
                let weatherText = weatherTypeMapping[weatherVal] || "Not Available";
                $("#weather_type").text(weatherText);

                $("#view-details").modal("show");
            },
            error: function() {
                alert("Failed to load item details.");
            }
        });
}
</script>

<script>
    var swiper = new Swiper(".mySwiper", {
    slidesPerView: 5,
    spaceBetween: 20,

    breakpoints: {
        0: {
            slidesPerView: 1,
            spaceBetween: 10,
        },

        576: {
            slidesPerView: 2,
            spaceBetween: 15,
        },

        768: {
            slidesPerView: 3,
            spaceBetween: 20,
        },

        1200: {
            slidesPerView: 5,
            spaceBetween: 20,
        }
    }
});

</script>